<link rel='import' href='./pro-i18n-behaviour.html'>
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">

<dom-module id="pro-language-switcher">
  <style>
    :host {
      display: inline;
    }
  </style>

  <style is="custom-style">
    paper-dropdown-menu {
      --paper-input-container-label: {
        font-style: italic;
      };

      --paper-input-container-input: {
        color: #eeeeee;
      }
    }
  </style>

  <template>
    <paper-dropdown-menu label="Language" vertical-align="bottom" horizontal-align="left">
      <paper-listbox class="dropdown-content" selected="[[selectedLangIndex]]">
        <paper-item>{{t('pro-language-switcher-es')}}</paper-item>
        <paper-item>{{t('pro-language-switcher-en')}}</paper-item>
      </paper-listbox>
    </paper-dropdown-menu>
  </template>

  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'pro-language-switcher',

      behaviors: [window.MyBehaviours.proI18nBehaviour],

      properties: {
        selectedLangIndex: Number
      },

      created: function() {
        this.appendLocale('es', 'pro-language-switcher-es', 'Castellano (ES)');
        this.appendLocale('en', 'pro-language-switcher-es', 'Spanish (ES)');
        this.appendLocale('es', 'pro-language-switcher-en', 'Ingl√©s (EN)');
        this.appendLocale('en', 'pro-language-switcher-en', 'English (EN)');
      },

      attached: function(){
        switch(window.I18n.lang) {
            case 'es':
            this.selectedLangIndex = 0;
                break;
            case 'en':
            this.selectedLangIndex = 1;
                break;
            default:;
        }
      },

      _updateLangQueryStringParameter: function(value) {
        window.I18n.lang = value;
        window.location.href = window.location.updateQueryStringParameter(window.location.href, 'lang', value);
      },

      _langChange: function(language) {
        if (language !== window.I18n.lang) {
          this._updateLangQueryStringParameter(language);
        }
      },

      listeners: {
        'selected-item-label-changed': '_langChanged'
      },

      _langChanged: function(newLangEvent){
        var newLang = newLangEvent.detail.value;
        if(newLang === es){
          this._langChange('es');
        }
        if(newLang === en){
          this._langChange('en');
        }
      }
    });
  })();
  </script>
</dom-module>
